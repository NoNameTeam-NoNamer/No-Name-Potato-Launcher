<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="No_Name_Potato_Launcher.ColorTextPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:No_Name_Potato_Launcher"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    NavigationCacheMode="Enabled"
    mc:Ignorable="d">
    <Page.Resources>
        <!-- 注册转换器 -->
        <local:ListToGradientStopCollectionConverter x:Key="ListToGradientStopConverter" />
        <local:ColorToBrushConverter x:Key="ColorToBrushConverter"/>
        <DataTemplate x:Key="ColorStyleShow" x:DataType="local:ColorTheme">
            <TextBlock Text="{x:Bind name}" TextWrapping="WrapWholeWords" TextAlignment="Left">
                <TextBlock.Foreground>
                    <LinearGradientBrush GradientStops="{x:Bind Stops, Converter={StaticResource ListToGradientStopConverter}}"/>
                </TextBlock.Foreground>
            </TextBlock>
        </DataTemplate>
        <DataTemplate x:Key="ColorStyleEdit" x:DataType="local:GradientStop">
            <ProgressBar Width="365" Minimum="0" Maximum="1"
                    Value="{x:Bind Offset}" HorizontalAlignment="Center"
                    Foreground="{x:Bind Color, Converter={StaticResource ColorToBrushConverter}}" Background="{x:Bind Color, Converter={StaticResource ColorToBrushConverter}}"/>
        </DataTemplate>
    </Page.Resources>
    <Grid>
        <StackPanel HorizontalAlignment="Center" Orientation="Vertical" x:Name="UIPanel">
            <TextBlock x:Name="StatusTextBlock" TextAlignment="Center" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="6">
                <TextBlock.Transitions>
                    <TransitionCollection>
                        <AddDeleteThemeTransition/>
                    </TransitionCollection>
                </TextBlock.Transitions>
            </TextBlock>
            <TextBox x:Name="InputBox" PlaceholderText="彩字文本"
                     HorizontalAlignment="Center" VerticalAlignment="Center" MaxWidth="600"
                     AcceptsReturn="True" TextWrapping="Wrap" MaxHeight="225">
                <TextBox.Transitions>
                    <TransitionCollection>
                        <RepositionThemeTransition/>
                    </TransitionCollection>
                </TextBox.Transitions>
            </TextBox>
            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                <Button Width="525" Height="30" Margin="3,12" x:Name="PreviewButton">
                    <Button.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                            <GradientStop Color="#ee7700" Offset="0"/>
                            <GradientStop Color="#00bbee" Offset="1"/>
                        </LinearGradientBrush>
                    </Button.Background>
                    <Button.Flyout>
                        <Flyout>
                            <StackPanel>
                                <ListView x:Name="ThemeChoose" ItemTemplate="{StaticResource ColorStyleShow}" BorderThickness="1" Margin="3" ItemsSource="{x:Bind Themes}" Width="400"
                                          HorizontalAlignment="Center" SelectionChanged="ThemeChoose_SelectionChanged" MaxHeight="200"/>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" x:Name="SetThemeFlyoutBasePanel">
                                    <ComboBox Width="150" x:Name="FormatChoose" SelectionChanged="ChangeFormat" Margin="3" Height="32">
                                        <x:String>#AARRGGBBx</x:String>
                                        <x:String>#RRGGBBx</x:String>
                                        <x:String>&amp;#RRGGBBx</x:String>
                                    </ComboBox>
                                    <Button Click="DeleteColorTheme" Margin="3">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <SymbolIcon Symbol="Delete" Margin="0,0,4,0" Foreground="{ThemeResource SystemFillColorCriticalBrush}" />
                                            <TextBlock Text="删除" Foreground="{ThemeResource SystemFillColorCriticalBrush}" />
                                        </StackPanel>
                                    </Button>
                                    <Button Click="EditColorTheme" Margin="3">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <SymbolIcon Symbol="Repair" Margin="0,0,4,0" Foreground="{ThemeResource SystemFillColorAttentionBrush}" />
                                            <TextBlock Text="修改" Foreground="{ThemeResource SystemFillColorAttentionBrush}" />
                                        </StackPanel>
                                    </Button>
                                    <Button Click="AddColorTheme" Margin="3">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <SymbolIcon Symbol="Add" Margin="0,0,4,0" Foreground="{ThemeResource SystemFillColorSuccessBrush}" />
                                            <TextBlock Text="新建" Foreground="{ThemeResource SystemFillColorSuccessBrush}" />
                                        </StackPanel>
                                    </Button>
                                    <FlyoutBase.AttachedFlyout>
                                        <Flyout Opening="InitialEditPanel">
                                            <StackPanel Orientation="Vertical">
                                                <TextBox x:Name="ThemeNameBox" Margin="3" HorizontalAlignment="Center" LostFocus="ChangeThemeName" MaxWidth="400" MaxHeight="100"
                                                        TextWrapping="Wrap" AcceptsReturn="False" MaxLength="48"/>
                                                <ListView x:Name="ThemeEditor" ItemTemplate="{StaticResource ColorStyleEdit}" BorderThickness="1" Margin="3" Width="400"
                                                        HorizontalAlignment="Center" SelectionChanged="ThemeChoose_SelectionChanged" MaxHeight="200"/>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" x:Name="SetColorFlyoutBasePanel">
                                                    <Button Click="DeleteColor" Margin="3">
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <SymbolIcon Symbol="Delete" Margin="0,0,4,0" Foreground="{ThemeResource SystemFillColorCriticalBrush}" />
                                                            <TextBlock Text="删除" Foreground="{ThemeResource SystemFillColorCriticalBrush}" />
                                                        </StackPanel>
                                                    </Button>
                                                    <Button Click="EditColor" Margin="3">
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <SymbolIcon Symbol="Repair" Margin="0,0,4,0" Foreground="{ThemeResource SystemFillColorAttentionBrush}" />
                                                            <TextBlock Text="修改" Foreground="{ThemeResource SystemFillColorAttentionBrush}" />
                                                        </StackPanel>
                                                    </Button>
                                                    <Button Click="AddColor" Margin="3">
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <SymbolIcon Symbol="Add" Margin="0,0,4,0" Foreground="{ThemeResource SystemFillColorSuccessBrush}" />
                                                            <TextBlock Text="新建" Foreground="{ThemeResource SystemFillColorSuccessBrush}" />
                                                        </StackPanel>
                                                    </Button>
                                                    <FlyoutBase.AttachedFlyout>
                                                        <Flyout Opening="InitialEditColorPanel">
                                                            <StackPanel Orientation="Vertical">
                                                                <Slider Minimum="0" Maximum="1" StepFrequency="0.01" SmallChange="0.0001" TickFrequency="0.1" Margin="3" Width="300" ValueChanged="ChangeValue"
                                                                        TickPlacement="Outside" HorizontalAlignment="Center" x:Name="StopValueEditor" Header="位置"/>
                                                                <ColorPicker ColorSpectrumShape="Box" IsMoreButtonVisible="True" IsColorSliderVisible="True" IsColorChannelTextInputVisible="True" ColorChanged="ChangeColor"
                                                                    IsHexInputVisible="True" IsAlphaEnabled="True" IsAlphaSliderVisible="True" IsAlphaTextInputVisible="True" x:Name="StopColorEditor" Margin="3"/>
                                                            </StackPanel>
                                                        </Flyout>
                                                    </FlyoutBase.AttachedFlyout>
                                                </StackPanel>
                                            </StackPanel>
                                        </Flyout>
                                    </FlyoutBase.AttachedFlyout>
                                </StackPanel>
                            </StackPanel>
                        </Flyout>
                    </Button.Flyout>
                </Button>
                <Button Content="生成" Width="75" Height="30" Margin="3,12" Click="GenerateButton_Click" Style="{StaticResource AccentButtonStyle}" x:Name="GenerateButton"/>
            </StackPanel>
            <ProgressBar Value="100" Width="620" HorizontalAlignment="Center" VerticalAlignment="Bottom" x:Name="ProcessOutput"/>
            <Button Click="OpenInWindow" Content="创建独立窗口实例" x:Name="WindowButton" HorizontalAlignment="Center" Margin="16"/>
        </StackPanel>
    </Grid>
</Page>
